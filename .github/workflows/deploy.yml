name: Deploy to PythonAnywhere

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via PythonAnywhere API
        env:
          PA_API_TOKEN: ${{ secrets.PYTHONANYWHERE_API_TOKEN }}
          PA_USERNAME: nnnkeita
          PA_DOMAIN: nnnkeita.pythonanywhere.com
        run: |
          if [ -z "${{ secrets.PYTHONANYWHERE_API_TOKEN }}" ]; then
            echo "❌ PYTHONANYWHERE_API_TOKEN is not set"
            exit 1
          fi
          
          # API経由でWebアプリをリロード
          curl -X POST \
            -H "Authorization: Token ${{ secrets.PYTHONANYWHERE_API_TOKEN }}" \
            https://www.pythonanywhere.com/api/v0/user/nnnkeita/webapps/nnnkeita.pythonanywhere.com/reload/
          
          echo "✅ Reload request sent to PythonAnywhere"
